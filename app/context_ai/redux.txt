--- start of file app/redux/store.js

import { configureStore } from '@reduxjs/toolkit';
import authReducer from './slices/authSlice'; // Lo crearemos en el siguiente paso

export const store = configureStore({
reducer: {
  auth: authReducer,
  courses: courseReducer, // (Ejemplo) Reducer para cursos
  notifications: notificationReducer, // (Ejemplo) Reducer para notificaciones

  // Aquí puedes añadir otros reducers para diferentes partes de tu estado
  // Por ejemplo: courses: coursesReducer, notifications: notificationsReducer
},
// configureStore ya incluye redux-thunk y Redux DevTools Extension por defecto
// No necesitas applyMiddleware(thunk) explícitamente aquí
});
--- end of file app/redux/store.js


--- start of file app/redux/slices/authSlice.js
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';
import axios from 'axios';
import AsyncStorage from '@react-native-async-storage/async-storage';

// Define la URL base de tu backend
// IMPORTANTE: Usa la IP de tu máquina si estás en un emulador/dispositivo real
// Si estás en un emulador de Android, '10.0.2.2' es tu localhost
// Si estás en un emulador de iOS, 'localhost' o '127.0.0.1' funciona
// Si estás en un dispositivo físico, necesitas la IP de tu máquina en la misma red
const API_BASE_URL = 'http://192.168.0.183:3000/api'; // <--- ¡CAMBIA ESTO!

// Thunk para el login asíncrono
export const loginUser = createAsyncThunk(
'auth/loginUser',
async ({ email, password }, { rejectWithValue }) => {
  try {
    const response = await axios.post(`${API_BASE_URL}/auth/login`, { email, password });
    const { token: receivedToken, user: userData } = response.data;

    await AsyncStorage.setItem('userToken', receivedToken);
    await AsyncStorage.setItem('userData', JSON.stringify(userData));

    return { token: receivedToken, user: userData };
  } catch (error) {
    // Usa rejectWithValue para pasar el error al reducer
    return rejectWithValue(error.response?.data?.message || error.message || 'Error desconocido al iniciar sesión');
  }
}
);

// Thunk para cargar el estado de autenticación desde AsyncStorage
export const loadAuthData = createAsyncThunk(
'auth/loadAuthData',
async (_, { rejectWithValue }) => {
  try {
    const storedToken = await AsyncStorage.getItem('userToken');
    const storedUser = await AsyncStorage.getItem('userData');
    if (storedToken && storedUser) {
      return { token: storedToken, user: JSON.parse(storedUser) };
    }
    return null; // No hay datos de autenticación
  } catch (error) {
    return rejectWithValue(error.message || 'Error al cargar datos de autenticación');
  }
}
);

const authSlice = createSlice({
name: 'auth',
initialState: {
  user: null,
  token: null,
  isLoading: true, // Para la carga inicial del estado de autenticación
  isAuthenticated: false,
  error: null,
},
reducers: {
  // Reducer para el logout
  logout: (state) => {
    state.user = null;
    state.token = null;
    state.isAuthenticated = false;
    state.error = null;
    AsyncStorage.removeItem('userToken');
    AsyncStorage.removeItem('userData');
  },
  // Puedes añadir otros reducers síncronos aquí si los necesitas
},
extraReducers: (builder) => {
  builder
    // Manejo del loginUser
    .addCase(loginUser.pending, (state) => {
      state.isLoading = true;
      state.error = null;
    })
    .addCase(loginUser.fulfilled, (state, action) => {
      state.isLoading = false;
      state.isAuthenticated = true;
      state.user = action.payload.user;
      state.token = action.payload.token;
    })
    .addCase(loginUser.rejected, (state, action) => {
      state.isLoading = false;
      state.isAuthenticated = false;
      state.user = null;
      state.token = null;
      state.error = action.payload; // El error que pasamos con rejectWithValue
    })
    // Manejo de loadAuthData
    .addCase(loadAuthData.pending, (state) => {
      state.isLoading = true;
    })
    .addCase(loadAuthData.fulfilled, (state, action) => {
      state.isLoading = false;
      if (action.payload) {
        state.isAuthenticated = true;
        state.user = action.payload.user;
        state.token = action.payload.token;
      } else {
        state.isAuthenticated = false;
      }
    })
    .addCase(loadAuthData.rejected, (state, action) => {
      state.isLoading = false;
      state.isAuthenticated = false;
      state.user = null;
      state.token = null;
      state.error = action.payload;
    });
},
});

export const { logout } = authSlice.actions; // Exporta la acción de logout
export default authSlice.reducer; // Exporta el reducer por defecto

--- end of file app/redux/slices/authSlice.js




--- start of file app/redux/reducers/authReducer.js
import {
LOGIN_REQUEST,
LOGIN_SUCCESS,
LOGIN_FAILURE,
LOGOUT,
LOAD_AUTH_DATA_REQUEST,
LOAD_AUTH_DATA_SUCCESS,
LOAD_AUTH_DATA_FAILURE,
} from '../types';

const initialState = {
user: null,
token: null,
isLoading: true, // Para la carga inicial del estado de autenticación
isAuthenticated: false,
error: null,
};

const authReducer = (state = initialState, action) => {
switch (action.type) {
  case LOGIN_REQUEST:
    return {
      ...state,
      isLoading: true,
      error: null,
    };
  case LOGIN_SUCCESS:
    return {
      ...state,
      isLoading: false,
      isAuthenticated: true,
      user: action.payload.user,
      token: action.payload.token,
      error: null,
    };
  case LOGIN_FAILURE:
    return {
      ...state,
      isLoading: false,
      isAuthenticated: false,
      user: null,
      token: null,
      error: action.payload,
    };
  case LOGOUT:
    return {
      ...state,
      user: null,
      token: null,
      isAuthenticated: false,
      error: null,
    };
  case LOAD_AUTH_DATA_REQUEST:
    return {
      ...state,
      isLoading: true,
      error: null,
    };
  case LOAD_AUTH_DATA_SUCCESS:
    return {
      ...state,
      isLoading: false,
      isAuthenticated: !!action.payload.token, // Es autenticado si hay token
      user: action.payload.user,
      token: action.payload.token,
      error: null,
    };
  case LOAD_AUTH_DATA_FAILURE:
    return {
      ...state,
      isLoading: false,
      isAuthenticated: false,
      user: null,
      token: null,
      error: action.payload,
    };
  default:
    return state;
}
};

export default authReducer;

--- end of file app/redux/reducers/authReducer.js




--- start of file app/redux/actions/authActions.js
import axios from 'axios';
import AsyncStorage from '@react-native-async-storage/async-storage';
import {
LOGIN_REQUEST,
LOGIN_SUCCESS,
LOGIN_FAILURE,
LOGOUT,
LOAD_AUTH_DATA_REQUEST,
LOAD_AUTH_DATA_SUCCESS,
LOAD_AUTH_DATA_FAILURE,
} from '../types';

// Define la URL base de tu backend
const API_BASE_URL = 'http://YOUR_LOCAL_IP_OR_EMULATOR_IP:3000/api'; // <--- ¡CAMBIA ESTO!

// Action Creators síncronos
export const loginRequest = () => ({
type: LOGIN_REQUEST,
});

export const loginSuccess = (token, user) => ({
type: LOGIN_SUCCESS,
payload: { token, user },
});

export const loginFailure = (error) => ({
type: LOGIN_FAILURE,
payload: error,
});

export const logout = () => {
AsyncStorage.removeItem('userToken');
AsyncStorage.removeItem('userData');
return {
  type: LOGOUT,
};
};

export const loadAuthDataRequest = () => ({
type: LOAD_AUTH_DATA_REQUEST,
});

export const loadAuthDataSuccess = (token, user) => ({
type: LOAD_AUTH_DATA_SUCCESS,
payload: { token, user },
});

export const loadAuthDataFailure = (error) => ({
type: LOAD_AUTH_DATA_FAILURE,
payload: error,
});

// Thunk para el login asíncrono
export const loginUser = (email, password) => async (dispatch) => {
dispatch(loginRequest());
try {
  const response = await axios.post(`${API_BASE_URL}/auth/login`, { email, password });
  const { token, user } = response.data;

  await AsyncStorage.setItem('userToken', token);
  await AsyncStorage.setItem('userData', JSON.stringify(user));

  dispatch(loginSuccess(token, user));
  return true; // Indica éxito
} catch (error) {
  const errorMessage = error.response?.data?.message || error.message || 'Error de inicio de sesión';
  dispatch(loginFailure(errorMessage));
  return false; // Indica fallo
}
};

// Thunk para cargar el estado de autenticación desde AsyncStorage
export const loadAuthData = () => async (dispatch) => {
dispatch(loadAuthDataRequest());
try {
  const storedToken = await AsyncStorage.getItem('userToken');
  const storedUser = await AsyncStorage.getItem('userData');

  if (storedToken && storedUser) {
    dispatch(loadAuthDataSuccess(storedToken, JSON.parse(storedUser)));
  } else {
    dispatch(loadAuthDataSuccess(null, null)); // No hay datos, éxito pero sin autenticar
  }
} catch (error) {
  dispatch(loadAuthDataFailure(error.message || 'Error al cargar datos de autenticación'));
}
};

--- end of file app/redux/actions/authActions.js